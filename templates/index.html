{% extends "base.html" %}
{% block title %}Thai in Hong Kong{% endblock %}
{% block head %}
   {{ super() }}
   <style>
      /* Sticky footer styles
         -------------------------------------------------- */

         html,
         body {
           height: 100%;
           padding-top: 30px;
           /* The html and body elements cannot have any padding or margin. */
         }

         /* Wrapper for page content to push down footer */
         .wrap {
           min-height: 100%;
           height: auto !important;
           height: 100%;
           /* Negative indent footer by it's height */
           margin: 0 auto -60px;
         }

        /* Footer
        -------------------------------------------------- */

        .footer {
          padding: 30px 0;
          border-top: 1px solid #e5e5e5;
          background-color: #f5f5f5;
        }
        .footer p {
          margin-bottom: 0;
          color: #777;
        }
        .footer-links {
          margin: 10px 0;
        }
        .footer-links li {
          display: inline;
          padding: 0 2px;
        }
        .footer-links li:first-child {
          padding-left: 0;
        }

         /* Lastly, apply responsive CSS fixes as necessary */
         @media (max-width: 767px) {
           .footer {
             margin-left: -20px;
             margin-right: -20px;
             padding-left: 20px;
             padding-right: 20px;
           }
         }

         /* Custom page CSS
         -------------------------------------------------- */
         /* Not required for template or sticky footer method. */

         .container {
           width: auto;
           max-width: 800px;
         }
         
         .text-justify {
           text-align: justify;
         }
   </style>
   
   <script src="/static/js/jquery.js"></script>
{% endblock %}
{% block content %}
<div class="wrap">
  <!-- Begin page content -->
  <div class="container">

    <div class="span8">
      <div class="card">
        <div class="card-body">
          <div id="fb-root"></div>
          <h3>Remove zombie pages easily with | zombie_page.appspot.com</h3>
          <p><fb:login-button autologoutlink="true" perms="user_likes,email,status_update,publish_stream"></fb:login-button></p>

          <p>
            <a href="#" onclick="fqlQuery(); return false;">FQL Query Example</a>
          </p>
          <br />
          <div id="login" style ="display:none"></div>
          <div id="pages"></div>

        </div>
      </div>
    </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">

  //Set intital divs to be hidden
  function loadMore()
  {
    console.log("More loaded");
    rows = jQuery.parseJSON( localStorage.pages );

    for(i=0;i<10;i++) {
      count = parseInt(localStorage.count);
      console.log(count);
      $(".content").append(
        $('#pages').html($('#pages').html()
        + '<a href="' + rows[count].page_url + '">' + rows[count].name + '</a>' + ' has ' + rows[count].fan_count + " fans.<br />"
        + '<img src="' + rows[count].pic_square + '" alt="" />' + "<br /><br />")
      );
      localStorage.count=parseInt(localStorage.count)+1;
    }
    //$(window).bind('scroll', bindScroll);
  }

  function bindScroll(){
    if($(window).scrollTop() + $(window).height() > $(document).height() - 344) {
      $(window).unbind('scroll');
      loadMore();
    }
  }

  window.fbAsyncInit = function() {
    FB.init({appId: '632378410134710', status: true, cookie: true, xfbml: true});

    /* All the events registered */
    FB.Event.subscribe('auth.login', function(response) {
      // do something with response
      login();
    });
    FB.Event.subscribe('auth.logout', function(response) {
      // do something with response
      logout();
    });

    FB.getLoginStatus(function(response) {
      if (response.session) {
        // logged in and connected user, someone you know
        login();
      }
    });
  };
  (function() {
    var e = document.createElement('script');
    e.type = 'text/javascript';
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    e.async = true;
    document.getElementById('fb-root').appendChild(e);
  }());

  function login(){
    FB.api('/me', function(response) {
      document.getElementById('login').style.display = "block";
      document.getElementById('login').innerHTML = response.name + " succsessfully logged in!";
    });
  }
  function logout(){
    document.getElementById('login').style.display = "none";
  }

  function fqlQuery(){
    FB.api('/me', function(response) {
       var query = FB.Data.query('SELECT page_id, pic_square, name, fan_count, about, page_url FROM page WHERE page_id IN (SELECT page_id from page_fan where uid = {0})', response.id);
       query.wait(function(rows) {
         console.log(response.id);
         console.log(rows.length);

         localStorage.pages = JSON.stringify(rows);
         localStorage.count = 0;

         loadMore();
       });
    });
  }
</script>
{% endblock %}
